<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<!--Site sheets-->
	<link rel="stylesheet" href="../printStyle.css">
	<script src="../common.js" defer></script>
</head>
<body>
    <header>
        <!--Dummy tag, will be filled in with JS if needed-->
    </header>
    
    <main>
        <h1 style="margin-block-end:0">T2A17-Canvas-Curtis</h1>

        <hr>

        <section>
            Use these inputs to draw stuff on the canvas!<br><br>

           

            Preset scripts: <select id="scriptPresetsSelect"
                onchange="drawingCommandInput.value = this.value"
                style="width:200px;"
            >
            </select>
            <textarea style="resize:vertical; width:725px; height:200px;" id="drawingCommandInput"></textarea>


            <button onclick="drawAllCommands(); localStorage.setItem('savedArtscript', drawingCommandInput.value)">Run ArtScript</button>
            <button onclick="canvasContext.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height)">Clear canvas</button>
            <button onclick="drawingCommandInput.value = localStorage.getItem('savedArtscript')">Load from last autosave</button>
            
            <br>
            <br>
            <br>

            Output:
            <canvas id="drawingCanvas" width="725" height="600" style="border:1px solid #000000"></canvas>
            
            
            <script>
                let drawingCommandInput = document.getElementById('drawingCommandInput')
                let drawingCanvas = document.getElementById('drawingCanvas')
                let canvasContext = drawingCanvas.getContext('2d')

                function drawAllCommands()
                {

                    // split the input program into its individual lines
                    everyCommandLine = drawingCommandInput.value.split('\n') 


                    // then split each line into their individual arguments
                    everyCommandArray = [] 
                    for(let i = 0; i < everyCommandLine.length; i++)
                    {
                        everyCommandArray[i] = everyCommandLine[i].split(' ')
                    }
                    
                    // Then iterate through all the commands!
                    for(commandArray of everyCommandArray)
                    {   
                        // commandArray[0] is the command name
                        // everything in the array afterwards is arguments to the ArtScript command

                        try{
                            switch(commandArray[0]){

                                case "width":
                                    canvasContext.lineWidth = commandArray[1]
                                    break
                                

                                case "color":
                                case "colour":
                                    commandArray.shift()

                                    canvasContext.strokeStyle = commandArray.join(' ')
                                    break


                                case "line":
                                    lineStartX = commandArray[1]
                                    lineStartY = commandArray[2]
                                    lineEndX = commandArray[3]
                                    lineEndY = commandArray[4]
                                
                                    canvasContext.beginPath();
                                    canvasContext.moveTo(lineStartX,lineStartY)
                                    canvasContext.lineTo(lineEndX,lineEndY)
                                    canvasContext.stroke()
                                    break
                                    
                                
                                case "circle":
                                    circleX = commandArray[1]
                                    circleY = commandArray[2]
                                    circleRadius = commandArray[3]

                                    canvasContext.beginPath()
                                    canvasContext.arc(circleX, circleY, circleRadius, 0, 2 * Math.PI, false);
                                    canvasContext.stroke()
                                    break

                                case "square":
                                    squareX =      Number(commandArray[1])
                                    squareY =      Number(commandArray[2])
                                    squareWidth =  Number(commandArray[3])
                                    squareHeight = Number(commandArray[4])
                                    
                                    canvasContext.beginPath()
                                    canvasContext.moveTo(squareX,                               squareY)
                                    canvasContext.lineTo(squareX,                               squareY + squareHeight)
                                    canvasContext.lineTo(squareX + squareWidth,                 squareY + squareHeight)
                                    canvasContext.lineTo(squareX + squareWidth,                 squareY)
                                    canvasContext.lineTo(squareX - (canvasContext.lineWidth/2), squareY)
                                    canvasContext.stroke()
                                    break

                                case "font":
                                    commandArray.shift()
                                    canvasContext.font = commandArray.join(' ')
                                    break

                                case "text":
                                    text = commandArray[1]
                                    textX = commandArray[2]
                                    textY = commandArray[3]

                                    canvasContext.fillText(text, textX, textY)
                                    break
                    
                                default:
                                    if(commandArray[0] != '')
                                    {
                                        console.log(`Command ${commandArray[0]} is not defined!`)
                                    }
                                    break
                                }
                        }
                        catch (error){console.error(error)}
                    }
                }
            </script>
        </section>
    </main>

    
    <div id="scriptPresetsDiv" style="display:none;">
        <option value=""></option>
        <option value="">Forest</option>
        <option value="">House</option>
        <option value="">Hangman</option>
    </div>

    <script>
        let scriptPresets = document.getElementById('scriptPresetsDiv').innerHTML

        document.getElementById('scriptPresetsSelect').innerHTML = scriptPresets
    </script>
</body>
</html>