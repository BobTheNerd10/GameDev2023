<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

	<!--Site sheets-->
	<link rel="stylesheet" href="../printStyle.css">
	<script src="../common.js" defer></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ricmoo/aes-js/e27b99df/index.js"></script>
</head>
<body>
    <header>
        <!--Dummy tag, will be filled in with JS if needed-->
    </header>
    <style>
        #encryptMethodSelectionBox, #decryptMethodSelectionBox 
        {
            width:50%;
        }
    </style>
    <main>
        <h1 style="margin-block-end:0">T2A15-Spy-Curtis</h1>

        <hr>

        <section>

            <!--Base text field-->
            Sample text: 
            <select id="sampleTextSelectionBox"
                onchange="baseTextField.value = this.value"
            >
                <option value=""></option>
                <option value="The 20 quick brown foxes jumped over the 34 lazy dogs 89 times.">Quick brown fox</option>
                <option value="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.">Lorem Ipsum</option>
                <option value="My secret password is WordPass12">Secret Password</option>
            </select><br>
            <textarea id="baseTextField" rows="4" cols="70"></textarea><br><br>





            <!--Encryption buttons-->
            <input 
                type="button" 
                value="Alphabet Encrypt" 
                onclick=
                "{
                    
                    let baseText = baseTextField.value
                    
                    encryptedTextField.value = swapAlphabets(latinAlphabet, encryptMethodSelectionBox.value, baseText) 
                }"
            >
            using 
            <select id="encryptMethodSelectionBox"></select>
            <br>
            
            <button
                onclick=
                "{
                    
                    let baseText = baseTextField.value
                    
                    encryptedTextField.value = btoa(baseText)
                }"
            >Base 64 Encrypt</button>
            <br>


            <button
                onclick=
                "{
                    
                    let baseText = baseTextField.value
                    let key = document.getElementById('encryptCounterKey').value

                    encryptCrypto(baseText, key, 'counter').then(
                        function(result) {encryptedTextField.value = result},
                        function(error) {console.error(error)}
                    )
                }"
            >Counter Encrypt</button> using <input id="encryptCounterKey" type="number"> as a number key.
            <br><br><br>





            <!--Encrypted field-->
            <textarea id="encryptedTextField" rows="4" cols="70"></textarea><br><br>





            <!--Decryption buttons-->
            <input
                type="button"
                value="Alphabet Decrypt"
                onclick=
                "
                    let encryptedText = encryptedTextField.value

                    decryptedTextField.value = swapAlphabets(decryptMethodSelectionBox.value, latinAlphabet, encryptedText) 
                "
            >
            using 
            <select id="decryptMethodSelectionBox"></select>
            <br>
            
            <button
                onclick=
                "{
                    
                    let encryptedText = encryptedTextField.value
                    
                    decryptedTextField.value = atob(encryptedText)
                }"
            >Base 64 Decrypt</button>
            <br>

            <button
                onclick=
                "{
                    
                    let encryptedText = encryptedTextField.value
                    let key = document.getElementById('decryptCounterKey').value

                    decryptCrypto(encryptedText, key, 'counter').then(
                        function(result) {decryptedTextField.value = result},
                        function(error) {console.error(error)}
                    )
                    
                }"
            >Counter Decrypt</button> using <input id="decryptCounterKey" type="number"> as a number key.
            <br><br><br>






            <!--Decrypted field-->
            <textarea id="decryptedTextField" rows="4" cols="70"></textarea>

            <p>For decryption with keys to work, keys in encryption and decryption must match.</p>

        </section>

        <script>
            let baseTextField      = document.getElementById('baseTextField')
            let encryptedTextField = document.getElementById('encryptedTextField')
            let decryptedTextField = document.getElementById('decryptedTextField')
            
            // The various cipher alphabets
            let latinAlphabet    = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'
            let rot13Alphabet    = 'nopqrstuvwxyzabcdefghijklmNOPQRSTUVWXYZABCDEFGHIJKLM1234567890'
            let atbashAlphabet   = 'zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA9876543210' // Reverse alphabet
            let caeserAlphabet   = 'defghijklmnopqrstuvwxyzabcDEFGHIJKLMNOPQRSTUVWXYZABC4567891230' // 3 letters back
            let cyrillicAlpahbet = 'абцдефгһижклмнопԛрстувԝхйзАБЦДЕФГҺИЖКЛМНОПԚРСТУВԜХЙЗ1234567890' // Cyrillic (for funsies, not a good encryption method as people who know slavic languages can supposedly read it)
            let screamingAlphabet= 'aaaaaaaaaaaaaaaaaaaaaaaaaaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA' // Screaming
            let swearAlphabet    = '})@(#*$&%^~`¤¿+=|":;?/>[<,})@(#*$&%^~`¤¿+=|":;?/>[<,ϒΣϞπΩΦΘΞΨζ' // Hehe

            let listOfAlphabets = 
            {
                
                "Atbash"   : atbashAlphabet,
                "Caeser"   : caeserAlphabet,
                "Rot 13"   : rot13Alphabet,
                //"Cyrillic" : cyrillicAlpahbet,
                //"Latin"    : latinAlphabet,
                //"Swear (Punctuation)"     : swearAlphabet,
                //"Screaming (AAAAAAAAA)"   : screamingAlphabet,
            }

            // Select boxes for the alphabets
            let encryptMethodSelectionBox = document.getElementById('encryptMethodSelectionBox')
            let decryptMethodSelectionBox = document.getElementById('decryptMethodSelectionBox')
            for(alphabetText of Object.keys(listOfAlphabets))
            {
                let alphabetOption = document.createElement('option')
                alphabetOption.innerHTML = alphabetText
                alphabetOption.value = listOfAlphabets[alphabetText]

                encryptMethodSelectionBox.innerHTML += alphabetOption.outerHTML
                decryptMethodSelectionBox.innerHTML += alphabetOption.outerHTML
            }


            // Functions for that hey!!
            function swapAlphabets(inputAlphabet, outputAlphabet, baseText)
            {
                let outputText = ""
                for(character of baseText)
                {
                    positionOfCharacterInEncryptedAlphabet = inputAlphabet.indexOf(character)
                    if(positionOfCharacterInEncryptedAlphabet != -1) // indexOf returns -1 if the input isnt in the given text
                    {
                        character = outputAlphabet[positionOfCharacterInEncryptedAlphabet]
                    }
                    outputText += character
                }
                return outputText
            }






            async function encryptCrypto(inputText, key = 1, method = "counter")
            {
                // Convert the input text to text bytes
                textBytes = aesjs.utils.utf8.toBytes(inputText)

                // Keep the key within the acceptable range
                key = (key**2) % 128

                // Generate a new cipher instance
                counterKey = [Number(key), 2, 3, 4, 5, 6, Number(key), 8, 9, 10, 11, Number(key*2), 13, 14, 15, 16 ];
                console.log(counterKey)
                aesCounterCipher = new aesjs.ModeOfOperation.ctr(counterKey);

                
                // Encrypt the textBytes using the cipher instance
                // This gives a bunch of encrypted bytes
                encryptedBytes = aesCounterCipher.encrypt(textBytes);

                // convert the bytes to hex to get our encrypted text
                return aesjs.utils.hex.fromBytes(encryptedBytes);
            }


            async function decryptCrypto(inputText, key = 1, method = 'counter')
            {
                // For the counter method, the input text is just a bunch of hex, so we convert it back to bytes
                encryptedBytes = aesjs.utils.hex.toBytes(inputText);
                
                // Keep the key within the acceptable range
                key = (key**2) % 128
                
                // Generate a new cipher instance
                counterKey = [Number(key), 2, 3, 4, 5, 6, Number(key), 8, 9, 10, 11, Number(key*2), 13, 14, 15, 16 ];
                aesCounterCipher = new aesjs.ModeOfOperation.ctr(counterKey);

                // Decrypt the bytes using the cipher
                decryptedBytes = aesCounterCipher.decrypt(encryptedBytes);

                // Convert the bytes back into text
                return aesjs.utils.utf8.fromBytes(decryptedBytes);
            }
        </script>
    </main>
</body>
</html>